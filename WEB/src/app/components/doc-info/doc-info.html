<h1 class="text-3xl font-bold text-[#283845] mb-5">
    GESTION DE DOCUMENTOS - Fase ID: {{ faseId }}
</h1>
<div class="border border-black p-6 rounded-lg mb-8 bg-gray-50">
    <h3 class="text-xl font-semibold text-gray-800 mb-4">
        {{ isEditMode ? 'Editar Documento Existente' : 'Subir Nuevo Documento'
        }}
    </h3>

    <form
        [formGroup]="documentoForm"
        (ngSubmit)="onSubmit()"
        class="grid grid-cols-1 md:grid-cols-4 gap-6"
    >
        <input type="hidden" formControlName="fase" />

        <div class="md:col-span-2">
            <label
                for="nombre"
                class="block text-sm font-medium text-gray-700"
            >Nombre del Documento</label>
            <input
                id="nombre"
                type="text"
                formControlName="nombre"
                class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 text-sm focus:ring-blue-500 focus:border-blue-500"
                placeholder="Ej: Plano Final A1"
                required
            />
            <div
                *ngIf="documentoForm.get('nombre')?.invalid && documentoForm.get('nombre')?.touched"
                class="text-red-500 text-xs mt-1"
            >
                El nombre es requerido.
            </div>
        </div>

        <div>
            <label
                for="tipo"
                class="block text-sm font-medium text-gray-700"
            >Tipo (Ej: PDF)</label>
            <input
                id="tipo"
                type="text"
                formControlName="tipo"
                class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 text-sm focus:ring-blue-500 focus:border-blue-500"
                placeholder="PDF"
                required
            />
            <div
                *ngIf="documentoForm.get('tipo')?.invalid && documentoForm.get('tipo')?.touched"
                class="text-red-500 text-xs mt-1"
            >
                El tipo es requerido.
            </div>
        </div>

        <div>
            <label
                for="fecha"
                class="block text-sm font-medium text-gray-700"
            >Fecha</label>
            <input
                id="fecha"
                type="date"
                formControlName="fecha"
                class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 text-sm focus:ring-blue-500 focus:border-blue-500"
                required
            />
            <div
                *ngIf="documentoForm.get('fecha')?.invalid && documentoForm.get('fecha')?.touched"
                class="text-red-500 text-xs mt-1"
            >
                La fecha es requerida.
            </div>
        </div>

        <div class="md:col-span-4">
            <label
                for="documentoFile"
                class="block text-sm font-medium text-gray-700"
            >
                Archivo
                <span
                    *ngIf="isEditMode"
                    class="text-xs text-gray-500 italic"
                >
                    (Opcional: Si no selecciona, se mantiene el actual: {{
                    documentoForm.get('documento')?.value }})
                </span>
            </label>
            <input
                id="documentoFile"
                type="file"
                (change)="onFileSelected($event)"
                class="mt-1 block w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-200 file:text-blue-800 hover:file:bg-blue-300 transition"
            />

            <div
                *ngIf="documentoForm.get('documento')?.invalid && documentoForm.get('documento')?.touched && !isEditMode"
                class="text-red-500 text-xs mt-1"
            >
                El archivo es requerido para la creaci√≥n.
            </div>
            <div
                *ngIf="selectedFile"
                class="text-sm text-green-700 mt-1 font-medium"
            >
                ‚úî Archivo listo para subir: {{ selectedFile.name }}
            </div>
        </div>

        <div class="md:col-span-4 flex space-x-4 mt-4">
            <button
                type="submit"
                [disabled]="documentoForm.invalid && !isEditMode && !selectedFile"
                class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 ease-in-out disabled:bg-gray-400 disabled:cursor-not-allowed"
            >
                {{ isEditMode ? '‚úÖ Guardar Cambios' : '‚¨ÜÔ∏è Subir Documento' }}
            </button>
            <button
                type="button"
                (click)="resetForm()"
                class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition duration-150 ease-in-out"
            >
                {{ isEditMode ? '‚ùå Cancelar Edici√≥n' : 'üóëÔ∏è Limpiar Formulario'
                }}
            </button>
        </div>
    </form>
</div>

<div class="mt-8">
    <h1 class="text-3xl font-bold text-[#283845] mb-5">
        Documentos Registrados
    </h1>

    <div *ngIf="isLoading" class="text-center py-8">
        <div
            class="spinner-border animate-spin inline-block w-8 h-8 border-4 rounded-full text-blue-500"
            role="status"
        >
        </div>
        <p class="text-blue-600 mt-2">Cargando documentos...</p>
    </div>

    <div
        *ngIf="!isLoading && documentos.length > 0"
        class="overflow-x-auto shadow-md rounded-lg"
    >
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                        ID
                    </th>
                    <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                        Nombre
                    </th>
                    <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                        Tipo
                    </th>
                    <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                        Fecha
                    </th>
                    <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                        Enlace
                    </th>
                    <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                        Acciones
                    </th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                <tr *ngFor="let doc of documentos" class="hover:bg-gray-50">
                    <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"
                    >
                        {{ doc.id }}
                    </td>
                    <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"
                    >
                        {{ doc.nombre }}
                    </td>
                    <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"
                    >
                        {{ doc.tipo }}
                    </td>
                    <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"
                    >
                        {{ doc.fecha | slice:0:10 }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <a
                            [href]="doc.documento"
                            target="_blank"
                            class="text-blue-600 hover:text-blue-800 font-medium transition duration-150"
                        >
                            Descargar
                        </a>
                    </td>
                    <td
                        class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-3"
                    >
                        <button
                            (click)="editDocumento(doc)"
                            class="text-yellow-600 hover:text-yellow-800 transition text-sm bg-yellow-100 p-1 rounded-md"
                        >
                            ‚úèÔ∏è Editar
                        </button>
                        <button
                            (click)="deleteDocumento(doc.id!)"
                            class="text-red-600 hover:text-red-800 transition text-sm bg-red-100 p-1 rounded-md"
                        >
                            üóëÔ∏è Eliminar
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div
        *ngIf="!isLoading && documentos.length === 0"
        class="text-center py-10 text-gray-500 border-t mt-4 bg-gray-50 rounded-lg"
    >
        <p>No se encontraron documentos registrados para esta fase.</p>
    </div>
</div>
