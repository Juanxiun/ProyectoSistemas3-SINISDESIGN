<app-navbar
    [id]="userData?.id"
    [Ubi]="'Clientes'" />
<div class="lg:h-[85%] md:h-[83%] h-[80%] w-full bg-black flex flex-row">
    <app-siderbar [admin]="userData?.admin" />
    <div class="bg-[rgb(246,239,229)] w-full h-full overflow-auto p-6 relative">
        
        <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-6 gap-4">
            <button 
                (click)="navegarACrear()"
                class="bg-[#E0A189] hover:bg-[#C97D60] text-white font-semibold py-2 px-6 rounded-lg shadow-md transition duration-300
                       flex items-center justify-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                </svg>
                NUEVO CLIENTE
            </button>

            <div class="flex flex-wrap items-center gap-3">
            
                <button 
                    (click)="onFiltroEstadoChange('activos')"
                    [class.bg-green-600]="filtroEstado === 'activos'"
                    [class.text-white]="filtroEstado === 'activos'"
                    [class.bg-white]="filtroEstado !== 'activos'"
                    [class.text-gray-700]="filtroEstado !== 'activos'"
                    class="px-4 py-2 rounded-lg font-semibold transition-all duration-200 border-2 border-transparent hover:border-green-600 flex items-center gap-2">
                    <i class="bi bi-check-circle"></i>
                    <span>Activos</span>
                    <span class="px-2 py-1 rounded-full text-xs font-bold"
                          [class.bg-green-100]="filtroEstado !== 'activos'"
                          [class.text-green-700]="filtroEstado !== 'activos'"
                          [class.bg-white]="filtroEstado === 'activos'"
                          [class.bg-opacity-20]="filtroEstado === 'activos'"
                          [class.text-white]="filtroEstado === 'activos'">
                        {{ totalActivos }}
                    </span>
                </button>

                <button 
                    (click)="onFiltroEstadoChange('inactivos')"
                    [class.bg-red-600]="filtroEstado === 'inactivos'"
                    [class.text-white]="filtroEstado === 'inactivos'"
                    [class.bg-white]="filtroEstado !== 'inactivos'"
                    [class.text-gray-700]="filtroEstado !== 'inactivos'"
                    class="px-4 py-2 rounded-lg font-semibold transition-all duration-200 border-2 border-transparent hover:border-red-600 flex items-center gap-2">
                    <i class="bi bi-x-circle"></i>
                    <span>Inactivos</span>
                    <span class="px-2 py-1 rounded-full text-xs font-bold"
                          [class.bg-red-100]="filtroEstado !== 'inactivos'"
                          [class.text-red-700]="filtroEstado !== 'inactivos'"
                          [class.bg-white]="filtroEstado === 'inactivos'"
                          [class.bg-opacity-20]="filtroEstado === 'inactivos'"
                          [class.text-white]="filtroEstado === 'inactivos'">
                        {{ totalInactivos }}
                    </span>
                </button>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-lg p-6 mb-6 border border-[#E8E8E8]">
            <div class="flex flex-col lg:flex-row gap-4">
                <div class="lg:w-60">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        Buscar por:
                    </label>
                    <select 
                        [(ngModel)]="campoBusqueda"
                        (change)="onCampoBusquedaChange()"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#E0A189] focus:border-transparent transition-all duration-200 bg-white cursor-pointer">
                        <option value="todos">Todos los campos</option>
                        <option value="ci">CI</option>
                        <option value="nombre">Nombre</option>
                        <option value="telefono">Teléfono</option>
                        <option value="correo">Correo</option>
                    </select>
                </div>

                <div class="flex-1">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        Término de búsqueda:
                    </label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                            <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <input 
                            type="text"
                            [(ngModel)]="searchTerm"
                            (input)="onSearchChange()"
                            [placeholder]="placeholderBusqueda"
                            class="w-full pl-12 pr-12 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#E0A189] focus:border-transparent transition-all duration-200"
                            [class.border-[#E0A189]]="searchActive">
                        <button 
                            *ngIf="searchTerm"
                            (click)="limpiarBusqueda2()"
                            class="absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-gray-600 transition-colors duration-200"
                            title="Limpiar búsqueda">
                            <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="lg:hidden flex items-end">
                    <button 
                        *ngIf="searchActive"
                        (click)="limpiarBusqueda2()"
                        class="w-full px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-lg transition duration-200">
                        Limpiar búsqueda
                    </button>
                </div>
            </div>

            <div *ngIf="searchActive" class="mt-4 flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium"
                          [class.bg-green-100]="clientesFiltrados.length > 0"
                          [class.text-green-800]="clientesFiltrados.length > 0"
                          [class.bg-yellow-100]="clientesFiltrados.length === 0"
                          [class.text-yellow-800]="clientesFiltrados.length === 0">
                        <svg *ngIf="clientesFiltrados.length > 0" class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                        <svg *ngIf="clientesFiltrados.length === 0" class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                        </svg>
                        {{ resultadosBusqueda }}
                    </span>
                </div>
            </div>
        </div>

        <div *ngIf="loading" class="flex flex-col justify-center items-center h-64 space-y-4">
            <div class="animate-spin rounded-full h-14 w-14 border-4 border-[#E0A189] border-t-[#722C23]"></div>
            <span class="text-[#283845] font-medium text-lg">{{ clientes.length > 0 ? 'Procesando...' : 'Cargando clientes...' }}</span>
        </div>

        <div *ngIf="loading && clientes.length > 0" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-8 shadow-2xl flex flex-col items-center space-y-4">
                <div class="animate-spin rounded-full h-16 w-16 border-4 border-[#E0A189] border-t-[#722C23]"></div>
                <p class="text-[#283845] font-semibold text-lg">Procesando solicitud...</p>
                <p class="text-gray-500 text-sm">Por favor espere</p>
            </div>
        </div>

        <div *ngIf="!loading" class="bg-white rounded-2xl shadow-xl overflow-hidden border border-[#E8E8E8]">
            
            <div *ngIf="clientes.length === 0" class="p-16 text-center text-gray-500">
                <div class="w-24 h-24 mx-auto mb-6 bg-[#F6EFE5] rounded-full flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-[#E0A189]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                </div>
                <p class="text-2xl font-bold text-[#283845] mb-3">No hay clientes registrados</p>
                <p class="text-gray-500 mb-6">Comienza agregando tu primer cliente usando el botón superior</p>
                <button 
                    (click)="navegarACrear()"
                    class="bg-[#722C23] hover:bg-[#5A231C] text-white font-semibold py-2 px-6 rounded-lg transition duration-200">
                    Agregar Primer Cliente
                </button>
            </div>

            <div *ngIf="clientes.length > 0 && clientesFiltrados.length === 0 && searchActive" class="p-16 text-center text-gray-500">
                <div class="w-24 h-24 mx-auto mb-6 bg-yellow-50 rounded-full flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
                <p class="text-2xl font-bold text-[#283845] mb-3">No se encontraron resultados</p>
                <p class="text-gray-500 mb-6">Intenta con otros términos de búsqueda o cambia el filtro</p>
                <button 
                    (click)="limpiarBusqueda2()"
                    class="bg-[#E0A189] hover:bg-[#C97D60] text-white font-semibold py-2 px-6 rounded-lg transition duration-200">
                    Limpiar búsqueda
                </button>
            </div>

            <div *ngIf="clientesFiltrados.length > 0" class="overflow-x-auto">
                <table class="min-w-full">
                    <thead class="bg-[#283845]">
                        <tr>
                            <th class="px-8 py-5 text-left text-sm font-semibold text-white uppercase tracking-wider border-r border-[#3A4A5B]">
                                <div class="flex items-center space-x-2">
                                    <span>CI</span>
                                </div>
                            </th>
                            <th class="px-8 py-5 text-left text-sm font-semibold text-white uppercase tracking-wider border-r border-[#3A4A5B]">
                                <div class="flex items-center space-x-2">
                                    <span>Nombre Completo</span>
                                </div>
                            </th>
                            <th class="px-8 py-5 text-left text-sm font-semibold text-white uppercase tracking-wider border-r border-[#3A4A5B]">
                                Teléfono
                            </th>
                            <th class="px-8 py-5 text-left text-sm font-semibold text-white uppercase tracking-wider border-r border-[#3A4A5B]">
                                Correo
                            </th>
                            <th class="px-8 py-5 text-left text-sm font-semibold text-white uppercase tracking-wider border-r border-[#3A4A5B]">
                                Estado
                            </th>
                            <th class="px-8 py-5 text-right text-sm font-semibold text-white uppercase tracking-wider">
                                Acciones
                            </th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-[#F0F0F0]">
                        <tr *ngFor="let cliente of clientesFiltrados; let i = index" 
                            class="hover:bg-[#F8F9FA] transition duration-200 group"
                            [class.bg-white]="i % 2 === 0"
                            [class.bg-[#FBFBFB]]="i % 2 === 1">
                            <td class="px-8 py-5 whitespace-nowrap">
                                <div class="text-base font-semibold text-[#283845] font-mono">
                                    {{ cliente.ci }}
                                </div>
                            </td>
                            <td class="px-8 py-5 whitespace-nowrap">
                                <div class="flex items-center space-x-3">
                                    <div>
                                        <div class="text-base font-semibold text-[#283845]">
                                            {{ cliente.nombre }} {{ cliente.apellido }}
                                        </div>
                                    </div>
                                </div>
                            </td>
                            <td class="px-8 py-5 whitespace-nowrap">
                                <div class="text-base text-gray-600 font-medium">
                                    {{ cliente.telefono }}
                                </div>
                            </td>
                            <td class="px-8 py-5 whitespace-nowrap">
                                <div class="text-base text-gray-600">
                                    {{ cliente.correo }}
                                </div>
                            </td>
                            <td class="px-8 py-5 whitespace-nowrap">
                                <div class="flex items-center space-x-2">
                                   <span class="px-4 py-2 inline-flex text-sm font-semibold rounded-full border"
                                        [class.bg-green-50]="convertirANumero(cliente.estado) === 1"
                                        [class.text-green-700]="convertirANumero(cliente.estado) === 1"
                                        [class.border-green-200]="convertirANumero(cliente.estado) === 1"
                                        [class.bg-red-50]="convertirANumero(cliente.estado) === 0"
                                        [class.text-red-700]="convertirANumero(cliente.estado) === 0"
                                        [class.border-red-200]="convertirANumero(cliente.estado) === 0">
                                    {{ convertirANumero(cliente.estado) === 1 ? 'Activo' : 'Inactivo' }}
                                    </span>
                                </div>
                            </td>
                            <td class="px-8 py-5 whitespace-nowrap text-right">
                                <div class="flex items-center justify-end space-x-3">
                                    <button 
                                        (click)="navegarAEditar(cliente.ci)"
                                        class="btn-accion btn-editar"
                                        title="Editar cliente">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                            <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                                        </svg>
                                    </button>
                                    <button 
                                        *ngIf="convertirANumero(cliente.estado) === 1"
                                        (click)="cambiarEstadoCliente(cliente.ci)"
                                        class="btn-accion btn-eliminar"
                                        title="Eliminar cliente">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                        </svg>
                                    </button>
                                    <button 
                                        *ngIf="convertirANumero(cliente.estado) === 0"
                                        (click)="cambiarEstadoCliente(cliente.ci)"
                                        class="btn-accion btn-restaurar"
                                        title="Restaurar cliente">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                                        </svg>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <app-notificacion
            *ngIf="mostrarNotif"
            [type]="tipoNotif"
            [message]="mensajeNotif"
            class="fixed top-4 right-4 z-50">
        </app-notificacion>
    </div>
</div>