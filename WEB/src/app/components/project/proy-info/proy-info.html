<section class="w-full h-full overflow-y-auto bg-[#f6efe5]">
    @if (loading) {
    <div class="flex flex-col justify-center items-center h-full">
        <div class="relative">
            <div class="animate-spin rounded-full h-16 w-16 border-4 border-[#92443a] border-t-transparent"></div>
            <div class="absolute inset-0 rounded-full h-16 w-16 border-4 border-[#E0A189] border-t-transparent animate-spin"
                style="animation-direction: reverse; animation-duration: 1.5s;"></div>
        </div>
        <span class="mt-4 text-lg text-[#92443a] font-semibold">Cargando proyecto...</span>
    </div>
    } @else if (error) {
    <div class="flex items-center justify-center h-full p-4">
        <div class="bg-red-50 border-2 border-red-300 p-6 rounded-xl shadow-lg max-w-md">
            <div class="flex items-center gap-3 mb-2">
                <i class="bi bi-exclamation-triangle-fill text-3xl text-red-500"></i>
                <p class="font-bold text-red-800 text-xl">Error</p>
            </div>
            <p class="text-red-700">{{ error }}</p>
        </div>
    </div>
    } @else {
    @if (proyectoData) {
    <div class="w-full h-full p-6">

        <!-- Header con imagen y título -->
        <div class="grid lg:grid-cols-3 gap-6 mb-6">

            <!-- Imagen del proyecto -->
            <div class="lg:col-span-1 relative">
                <div class="bg-white rounded-2xl overflow-hidden shadow-xl h-full">
                    @if (proyectoData.imagen) {
                    <div class="w-full h-72">
                        <img [src]="proyectoData.imagen" alt="{{ proyectoData.nombre }}"
                            class="w-full h-full object-cover" />
                    </div>
                    } @else {
                    <div class="w-full h-72 flex items-center justify-center bg-gray-100">
                        <i class="bi bi-image text-6xl text-gray-300"></i>
                    </div>
                    }
                </div>
                <!-- Botón editar proyecto -->
                <button (click)="editarProyecto()"
                    class="absolute top-4 right-4 bg-white/90 hover:bg-white text-[#92443a] p-3 rounded-full shadow-lg transition-all duration-200 hover:scale-110">
                    <i class="bi-pencil-square text-xl"></i>
                </button>
            </div>

            <!-- Información principal -->
            <div class="lg:col-span-2">
                <div class="bg-[#92443a] rounded-2xl shadow-xl p-8 h-full flex flex-col justify-between">
                    <div>
                        <div class="inline-flex items-center gap-2 mb-4">
                            <span [class]="getEstadoClass(proyectoData.est || 1)">
                                <i class="bi bi-circle-fill text-xs mr-1"></i>
                                {{ getEstadoText(proyectoData.est || 1) }}
                            </span>
                        </div>

                        <h1 class="text-4xl md:text-5xl font-bold text-white mb-6 uppercase leading-tight">
                            {{ proyectoData.nombre }}
                        </h1>
                    </div>

                    <div class="flex flex-wrap gap-4 text-white">
                        <div class="flex items-center gap-3 bg-white/20 px-4 py-3 rounded-xl">
                            <i class="bi bi-calendar-check text-2xl"></i>
                            <div>
                                <p class="text-xs text-white/70 uppercase">Inicio</p>
                                <p class="font-semibold">{{ formatDate(proyectoData.inicio) }}</p>
                            </div>
                        </div>

                        @if (proyectoData.final) {
                        <div class="flex items-center gap-3 bg-white/20 px-4 py-3 rounded-xl">
                            <i class="bi bi-calendar-event text-2xl"></i>
                            <div>
                                <p class="text-xs text-white/70 uppercase">Finalización</p>
                                <p class="font-semibold">{{ formatDate(proyectoData.final) }}</p>
                            </div>
                        </div>
                        }

                        <div class="flex items-center gap-3 bg-white/20 px-4 py-3 rounded-xl">
                            <i class="bi bi-cash-stack text-2xl"></i>
                            <div>
                                <p class="text-xs text-white/70 uppercase">Inversión</p>
                                <p class="font-semibold">{{ proyectoData.costo | number:'1.2-2' }} Bs</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Contenido principal -->
        <div class="grid lg:grid-cols-3 gap-6">

            <!-- Clasificación del proyecto -->
            <div class="lg:col-span-1 space-y-6">
                @if (tipo) {
                <div class="bg-white p-6 rounded-xl shadow-md h-full">
                    <div class="flex items-center gap-2 mb-6">
                        <i class="bi bi-tags-fill text-3xl text-[#92443a]"></i>
                        <h3 class="text-xl font-bold text-[#92443a]">Clasificación</h3>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-[#f6efe5] p-4 rounded-lg">
                            <p class="text-xs text-gray-500 uppercase tracking-wide mb-1">Tipo</p>
                            <p class="text-xl font-bold text-[#92443a]">{{ tipo.tipo }}</p>
                        </div>
                        <div class="bg-[#f6efe5] p-4 rounded-lg">
                            <p class="text-xs text-gray-500 uppercase tracking-wide mb-1">Subtipo</p>
                            <p class="text-xl font-bold text-[#92443a]">{{ tipo.subtipo }}</p>
                        </div>
                    </div>
                </div>
                } @else {
                <div
                    class="bg-yellow-50 border-2 border-yellow-300 p-6 rounded-xl shadow-md h-full flex items-center justify-center">
                    <div class="text-center">
                        <i class="bi bi-exclamation-circle-fill text-4xl text-yellow-600 mb-2"></i>
                        <p class="text-yellow-800 font-semibold">Información no disponible</p>
                    </div>
                </div>
                }
            </div>

            <!-- Fase actual destacada -->
            <div class="lg:col-span-2">
                @if (faseActual) {
                <div class="bg-[#92443a] p-8 rounded-xl shadow-lg text-white h-full">
                    <div class="flex items-center gap-3 mb-6">
                        <i class="bi bi-lightning-charge-fill text-4xl text-white"></i>
                        <h3 class="text-3xl font-bold text-white">Fase Actual</h3>
                    </div>

                    <div class="bg-white/20 p-6 rounded-xl mb-6">
                        <p class="text-4xl font-bold capitalize mb-3 text-white">
                            {{ faseActual.fase }}
                        </p>
                        @if (faseActual.detalle) {
                        <p class="text-white/90 text-lg mb-3">
                            {{ faseActual.detalle }}
                        </p>
                        }
                        @if (faseActual.estado) {
                        <span class="inline-block bg-white/30 px-4 py-2 rounded-lg text-sm font-semibold text-white">
                            {{ getEstadoText(faseActual.estado) }}
                        </span>
                        }
                        <button (click)="goDocumentos(faseActual.id)"
                            class="text-[#E0A189] hover:text-[#C97D60] font-semibold py-0.5 px-3 rounded-lg border border-[#E0A189] hover:border-[#C97D60] transition duration-300 ml-3.5">
                            Documentos
                        </button>
                    </div>

                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="bg-white/10 p-4 rounded-lg">
                            <div class="flex items-center gap-3">
                                <i class="bi bi-check-circle-fill text-3xl text-[#E0A189]"></i>
                                <div>
                                    <p class="text-xs text-white/70 uppercase">Inicio</p>
                                    <p class="font-bold text-lg text-white">{{ formatDate(faseActual.inicio) }}</p>
                                </div>
                            </div>
                        </div>

                        @if (faseActual.final) {
                        <div class="bg-white/10 p-4 rounded-lg">
                            <div class="flex items-center gap-3">
                                <i class="bi bi-flag-fill text-3xl text-[#E0A189]"></i>
                                <div>
                                    <p class="text-xs text-white/70 uppercase">Finalización</p>
                                    <p class="font-bold text-lg text-white">{{ formatDate(faseActual.final) }}</p>
                                </div>
                            </div>
                        </div>
                        } @else {
                        <div class="bg-white/10 p-4 rounded-lg">
                            <div class="flex items-center gap-3">
                                <i class="bi bi-clock-fill text-3xl text-[#E0A189]"></i>
                                <div>
                                    <p class="text-xs text-white/70 uppercase">Estado</p>
                                    <p class="font-bold text-lg text-white">En progreso</p>
                                </div>
                            </div>
                        </div>
                        }
                    </div>
                </div>
                } @else {
                <div class="bg-gray-100 p-8 rounded-xl shadow-lg h-full flex items-center justify-center">
                    <div class="text-center">
                        <i class="bi bi-hourglass-split text-6xl text-gray-400 mb-4"></i>
                        <p class="text-gray-600 font-bold text-xl">No hay fase activa</p>
                    </div>
                </div>
                }
            </div>

        </div>

        <!-- Lista de todas las fases -->
        @if (fases.length > 0) {
        <div class="bg-white p-8 rounded-xl shadow-md mt-6">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-3">
                    <i class="bi bi-list-check text-3xl text-[#92443a]"></i>
                    <h4 class="text-2xl font-bold text-[#92443a]">Historial de Fases</h4>
                </div>
                <span class="bg-[#92443a] text-white text-sm font-bold px-4 py-2 rounded-lg">
                    {{ fases.length }} {{ fases.length === 1 ? 'Fase' : 'Fases' }}
                </span>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                @for (fase of fases; track fase.id) {
                <div
                    [class]="'p-5 rounded-xl transition-all duration-200 border-2 ' + 
                                    (faseActual && fase.id === faseActual.id 
                                        ? 'bg-[#f6efe5] border-[#92443a] shadow-lg' 
                                        : 'bg-[#f6efe5] border-transparent hover:border-[#92443a] hover:shadow-md cursor-pointer')">
                    <div class="flex items-start justify-between mb-3">
                        <div class="relative flex-shrink-0">
                            <div
                                [class]="'w-4 h-4 rounded-full ' + (faseActual && fase.id === faseActual.id ? 'bg-[#92443a] animate-pulse' : 'bg-[#92443a]')">
                            </div>
                            @if (faseActual && fase.id === faseActual.id) {
                            <div class="absolute inset-0 w-4 h-4 rounded-full bg-[#E0A189] animate-ping"></div>
                            }
                        </div>

                        @if (faseActual && fase.id === faseActual.id) {
                        <span
                            class="flex items-center gap-1 text-xs font-bold text-[#92443a] bg-[#E0A189] px-3 py-1 rounded-full">
                            <i class="bi bi-star-fill"></i>
                            Actual
                        </span>
                        }
                    </div>

                    <p
                        [class]="'font-bold capitalize mb-2 text-lg ' + (faseActual && fase.id === faseActual.id ? 'text-[#92443a]' : 'text-gray-800')">
                        {{ fase.fase }}
                    </p>

                    @if (fase.detalle) {
                    <p class="text-sm text-gray-600 mb-3 line-clamp-2">
                        {{ fase.detalle }}
                    </p>
                    }

                    <div class="space-y-2">
                        <div class="flex items-center gap-2 text-xs text-gray-600">
                            <i class="bi bi-calendar3"></i>
                            <span>{{ formatDate(fase.inicio) }}</span>
                        </div>

                        @if (fase.estado !== undefined && fase.estado !== null) {
                        <span
                            [class]="'inline-block text-xs px-3 py-1 rounded-full font-medium ' + getEstadoClass(fase.estado)">
                            {{ getEstadoText(fase.estado) }}
                        </span>
                        }
                        <button (click)="goDocumentos(fase?.id)"
                            class="text-[#E0A189] hover:text-[#C97D60] font-semibold py-1 px-3 rounded-lg border border-[#E0A189] hover:border-[#C97D60] transition duration-300 ml-3.5">
                            Documentos
                        </button>
                    </div>
                </div>
                }
            </div>
        </div>
        } @else {
        <div class="bg-amber-50 border-2 border-amber-300 p-12 rounded-xl text-center shadow-md mt-6">
            <i class="bi bi-hourglass-split text-7xl text-amber-400 mb-4"></i>
            <p class="text-amber-800 font-bold text-2xl mb-2">No hay fases registradas</p>
            <p class="text-amber-600">Este proyecto aún no tiene fases configuradas</p>
        </div>
        }
        <div class="mt-8">
            <app-pagos
                [idproy]="idproy"
                [costoProyecto]="proyectoData?.costo || 0">
            </app-pagos>
        </div>
        
    </div>
    } @else {
    <div class="flex items-center justify-center h-full p-4">
        <div class="bg-red-50 border-2 border-red-300 p-8 rounded-xl shadow-lg text-center max-w-md">
            <i class="bi bi-emoji-frown text-6xl text-red-400 mb-4"></i>
            <p class="text-red-800 font-bold text-xl">No se encontró información del proyecto</p>
        </div>
    </div>
    }
    }
</section>