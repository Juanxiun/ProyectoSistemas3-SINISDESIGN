<app-navbar [id]="userData.id" [Ubi]="'Agenda'" />

<div class="lg:h-[85%] md:h-[83%] h-[80%] w-full bg-black flex flex-row">
  <app-siderbar [admin]="userData.admin" />

  <div class="w-full bg-[rgb(246,239,229)] p-4 overflow-auto">

    <!-- üîπ Encabezado -->
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-2xl font-bold text-gray-800">Agenda Semanal</h2>
      <div class="flex items-center gap-3">
        <button class="bg-gray-300 px-3 py-1 rounded-lg hover:bg-gray-400" (click)="semanaAnterior()">‚Äπ</button>
        <span class="font-semibold text-gray-800">{{ rangoSemana }}</span>
        <button class="bg-gray-300 px-3 py-1 rounded-lg hover:bg-gray-400" (click)="semanaSiguiente()">‚Ä∫</button>
        <button
          class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-xl transition"
          (click)="abrirFormulario()">
          + Nueva Reuni√≥n
        </button>
      </div>
    </div>

    <!-- üîπ Formulario NUEVA REUNI√ìN -->
    <div *ngIf="mostrarFormulario && !reunionSeleccionada">
      <app-nueva-reunion (reunionCreada)="cerrarFormulario()" />
    </div>

    <!-- üîπ Formulario EDITAR REUNI√ìN -->
    <div *ngIf="mostrarEditor && reunionSeleccionada">
      <app-editar-reunion
        [reunion]="reunionSeleccionada"
        (cerrar)="cerrarEditor($event)"
      ></app-editar-reunion>
    </div>

    <!-- üîπ Vista SEMANAL -->
    <ng-template [ngIf]="!mostrarFormulario && !mostrarEditor">
      <div class="overflow-x-auto border border-gray-300 rounded-lg bg-white">
        <table class="w-full border-collapse">
          <thead>
            <tr class="bg-gray-100 text-center text-gray-700">
              <th class="w-16 border border-gray-300 p-2"></th>
              <th *ngFor="let dia of diasSemana" class="border border-gray-300 p-2">
                {{ dia | date:'EEE dd/MM' }}
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let hora of horas" class="border-t border-gray-200 align-top">
              <td class="text-right pr-2 text-sm text-gray-500 w-16">
                {{ hora }}:00
              </td>
              <td *ngFor="let dia of diasSemana" class="h-16 border border-gray-200 relative">
                <ng-container *ngFor="let reunion of obtenerReunionesDelDiaYHora(dia, hora)">
                  <div
                    class="absolute left-1 right-1 bg-blue-500 text-white rounded-md px-2 py-1 text-xs cursor-pointer hover:bg-blue-600"
                    (click)="abrirEditor(reunion)">
                    {{ reunion.titulo }}
                    <br />
                    <span class="text-[10px] opacity-80">
                      {{ reunion.horaInicio }} - {{ reunion.horaFin }}
                    </span>
                  </div>
                </ng-container>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </ng-template>
  </div>
</div>
